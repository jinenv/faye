# Nyxa Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
-   **Esprit Team Management:** Implement `/esprit team` and `/esprit set` commands.
-   **Combat System:** Build out the core PvE `/adventure` loop.
-   **Audit Logging & Security:** Add admin action logging, database backups, and other security enhancements.

---

## [0.4.0] - 2025-06-10

This version introduces a major new economic feature with the Azurite crafting system and includes a significant refactor and stabilization of the administrative backend.

### Added
-   **Currency Crafting System:** Implemented a new `/craft` command allowing players to convert `Azurite Shards` into whole `Azurites`, creating a complete economic loop for the summoning currency.
-   **New Database Column:** Added a dedicated `azurites` column to the `User` table to support the new crafting system. This change was managed via a new Alembic migration file = 'ba895e40213d' branch_labels: Union[str, Sequence[str], None] = None depends_on: Union[str, Sequence[str], None] = None def upgrade() -> None: # ### commands auto generated by Alembic - please adjust! ### op.add_column('user', sa.Column('azurites', sa.Integer(), nullable=False, server_default='0')) # ### end Alembic commands ### def downgrade() -> None: # ### commands auto generated by Alembic - please adjust! ### op.drop_column('user', 'azurites') # ### end Alembic commands ###, src/database/models.py].
-   **Automated Startup Script:** Created `start.bat` and `start.sh` to provide a reliable, automated process for starting the bot, which includes running database migrations to prevent schema errors.

### Changed
-   **Summoning Economy:** The `/summon` command has been refactored to exclusively use the new `azurites` currency, reinforcing the crafting loop.
-   **Admin Cog Refactor:** All `give`/`remove`/`set` commands in `admin_cog.py` were refactored to use a centralized helper function, drastically reducing code duplication and improving maintainability.
-   **UI Consistency:** Updated the `/profile` and `/inventory` commands to accurately display the new separate `azurites` and `azurite_shards` balances.

### Fixed
-   **Admin Command Stability:** Resolved a critical bug where `give`/`remove`/`set` commands would cause the application to hang ("did not respond"). The fix involved replacing a fragile command factory pattern with more reliable, explicit command definitions.
-   **Paginator Crash:** Fixed an `UnboundLocalError` in the `/list esprits` command's pagination view, making it fully functional.

---

## [0.3.0] - 2025-06-09

This release marks a fundamental architectural overhaul, establishing a persistent, version-controlled database and a completely redesigned economy, setting the stage for all future content.

### Added
-   **Database Migration System**: Implemented `Alembic` to manage all database schema changes and static data seeding, ensuring a robust, production-ready workflow.
-   **New Currencies**: Introduced **Essence** (crafting material) and **Loot Chests** to the database model.
-   **Complete Admin Command Suite**: Built a full suite of owner-only commands under `/admin`, including:
    -   `/admin give` for all currencies (Nyxies, Moonglow, Azurite Shards, Essence) and XP.
    -   `/admin give esprit` to grant specific Esprits to users.
    -   `/admin reset` for user data and daily cooldowns.
    -   `/admin set` for player and Esprit levels.
    -   `/admin remove` to safely delete Esprit instances.
    -   `/admin inspect` and `/admin help` for utility.
-   **Cog Reloading**: Added an `/admin reload` command to allow for hot-reloading of cogs during development, significantly speeding up the iteration cycle.

### Changed
-   **Economy System Refactor**: The entire in-game economy has been restructured to align with the project directive.
    -   `gold` has been renamed to **Nyxies** (universal soft currency).
    -   `dust` has been renamed to **Moonglow** (Esprit enhancement currency).
    -   `fragments` has been renamed to **Azurite Shards**, which form **Azurites** (the sole summoning currency).
-   **Backend Stability**: Refactored all database models to resolve `InvalidRequestError` by explicitly defining foreign key relationships, stabilizing all commands.
-   **Cog Logic**: Updated `economy_cog`, `summon_cog`, `onboarding_cog`, and `admin_cog` to use the new currency names and database structure.

### Fixed
-   **Daily Command Logic**: Corrected a bug where `/reset daily` did not properly reset the cooldown for the `/daily` command by reverting to a database-driven timestamp check.
-   **Database Integrity**: Resolved all `AttributeError` and `InvalidRequestError` issues stemming from the database refactor.

---

## [0.2.0] - 2025-06-07

This release represents a complete redesign of the core summoning experience and a major refactor of the underlying architecture to improve stability, performance, and data integrity.

### Added
-   **Class System**: Introduced a `class_name` field to the `EspritData` model to categorize Esprits (e.g., Guardian, Destroyer).
-   **Dynamic "Rarity Aura"**: The summon card background now features a pronounced, soft aura of light, with the color dynamically set by the Esprit's rarity tier.
-   **Graphical Rarity Icons**: The card now renders a custom graphical icon for each rarity tier, replacing text-based rarity display on the image.
-   **Class Emojis**: The Discord embed for the summon result now displays the Esprit's class, prefixed with a thematic emoji for at-a-glance role identification.

### Changed
-   **Summon Card Redesign**: The card generated by `image_generator.py` is now minimalist and art-focused, containing only the Esprit's name as a header and a rarity icon.
-   **Summon Embed Redesign**: All detailed information (Class, Rarity Name) has been moved to the Discord embed's description field for a cleaner presentation.
-   **Summon Command Logic**: The `/summon` command has been restricted to only allow amounts of **1** or **10** to strengthen the game's economic loop.
-   **Atomic Transactions**: All database commands (`/start`, `/summon`, `/daily`, etc.) were refactored to use a single, atomic transaction per command.
-   **Asynchronous Image Generation**: Blocking image generation tasks were moved to a background thread (`run_in_executor`) to keep the bot responsive.
-   **Singleton `ConfigManager`**: The `ConfigManager` is now a shared instance created at bot startup to improve efficiency.

### Fixed
-   **Interaction Timeouts**: Resolved `404 Unknown Interaction` errors by implementing `interaction.response.defer()` for all long-running commands.
-   **Image Generation Stability**: Corrected multiple `TypeError` and `ValueError` bugs related to caching, image compositing, and silhouette generation.
-   **Data Integrity**: Fixed data mismatches between JSON configuration files and database models, particularly for the `class_name` field.

---

## [0.1.0] - 2025-06-06

### Changed
-   **Centralized Game Settings**: Refactored all cogs to pull economic values (e.g., starting Nyxies, daily rewards, summon costs) from a single configuration file at `data/config/game_settings.json`.
-   **Removed Hardcoded Values**: Eliminated "magic numbers" for economic parameters from the Python codebase, separating configuration from logic and improving maintainability.